<?xml version="1.0" encoding="utf-8" ?>
<!-- This is a sample Application Configuration File for OpenIZ IMS -->
<configuration>
  <configSections>
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral"/>
    <!-- The following lines must always exist in your configuration file -->
    <section name="marc.hi.ehrs.svc.core" type="MARC.HI.EHRS.SVC.Core.Configuration.HostConfigurationSectionHandler, MARC.HI.EHRS.SVC.Core, Version=2.0.0.0"/>
    <section name="openiz.core" type="SanteDB.Core.Configuration.ConfigurationSectionHandler, SanteDB.Core, Version=1.1.0.0"/>

    <!-- Registers the Microsoft SQL Server configuration section
    <section name="openiz.persistence.data.mssql" type="SanteDB.Persistence.Data.MSSQL.Configuration.SqlConfigurationSectionHandler, SanteDB.Persistence.Data.MSSQL, Version=1.1.0.0"/>
    -->
    <!-- Registers the HDSI (IMS Interface) configuration endpoint
    <section name="openiz.messaging.hdsi" type="SanteDB.Messaging.HDSI.Configuration.HdsiConfigurationSectionHandler, SanteDB.Messaging.HDSI, Version=1.1.0.0"/>
    -->

    <!-- Registers the OpenIZ Reporting Engine configuration section
    <section name="openiz.reporting.core" type="SanteDB.Reporting.Core.Configuration.ReportingConfigurationSectionHandler, SanteDB.Reporting.Core, Version=1.1.0.0"/>
    -->

    <!-- Registers the Authentication Control Service Configuration
      Do not un-comment if you are using a third party IdP like IdentityServer3
    <section name="openiz.authentication.oauth2" type="SanteDB.Authentication.OAuth2.Configuration.ConfigurationSectionHandler, SanteDB.Authentication.OAuth2, Version=1.1.0.0"/>
      -->

    <!-- Registers the HL7 FHIR interface configuration
    <section name="marc.hi.ehrs.svc.messaging.fhir" type="MARC.HI.EHRS.SVC.Messaging.FHIR.Configuration.ConfigurationSectionHandler, MARC.HI.EHRS.SVC.Messaging.FHIR, Version=2.0.0.0"/>
    -->

    <!-- Registers the Administration Management Interface (AMI)
    <section name="openiz.messaging.ami" type="SanteDB.Messaging.AMI.Configuration.AmiConfigurationSectionHandler, SanteDB.Messaging.AMI, Version=1.1.0.0"/>
    -->

    <!-- Registers the Memory Caching Configuration 
    <section name="openiz.caching.memory" type="SanteDB.Caching.Memory.Configuration.ConfigurationSectionHandler, SanteDB.Caching.Memory, Version=1.1.0.0"/>
    -->

    <!-- Registers the Timer Job Configuration 
    <section name="marc.hi.svc.core.timer" type="MARC.HI.EHRS.SVC.Core.Timer.Configuration.TimerConfigurationSectionHandler, MARC.HI.EHRS.SVC.Core.Timer, Version=2.0.0.0"/>
    -->

    <!-- Registers the ADO.NET (PostgreSQL, SQLite, etc) persistence configuration
    <section name="openiz.persistence.data.ado" type="SanteDB.Persistence.Data.ADO.Configuration.AdoConfigurationSectionHandler, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
    -->

    <!-- Registers the HL7 v2.x Interface Configuration
    <section name="marc.hi.ehrs.svc.messaging.hapi" type="MARC.HI.EHRS.SVC.Messaging.HAPI.Configuration.ConfigurationSectionHandler, MARC.HI.EHRS.SVC.Messaging.HAPI, Version=2.0.0.0"/>
    -->

    <!-- Registers JIRA Diagnostics for capturing diagnostic (sherlock) reports
    <section name="openiz.persistence.diagnostics.jira" type="SanteDB.Persistence.Diagnostics.Jira.Configuration.ConfigurationSectionHandler, SanteDB.Persistence.Diagnostics.Jira, Version=1.1.0.0"/>
    -->

    <!-- Registers the EMail Two-Factor Authentication and Password Recovery Section
    <section name="openiz.core.security.tfa.email" type="SanteDB.Core.Security.Tfa.Email.Configuration.ConfigurationSectionHandler, SanteDB.Core.Security.Tfa.Email, Version=1.1.0.0"/>
    -->

    <!-- Registers Twilio SMS Two-Factor Authentication and Password recovery 
    <section name="openiz.core.security.tfa.twilio" type="SanteDB.Core.Security.Tfa.Twilio.Configuration.ConfigurationSectionHandler, SanteDB.Core.Security.Tfa.Twilio, Version=1.1.0.0"/>
    -->

    <!-- Registers the HL7 v2.x notification services for PIX/PDQ 
    <section name="openiz.messaging.hl7.notification.pixpdq" type="SanteDB.Messaging.HL7.Configuration.Hl7ConfigurationSectionHandler, SanteDB.Messaging.HL7, Version=1.1.0.0"/>
    -->

    <!-- Registers the PostgreSQL Report Data Store 
    <section name="openiz.persistence.reporting.psql" type="SanteDB.Persistence.Reporting.PSQL.Configuration.ConfigurationSectionHandler, SanteDB.Persistence.Reporting.PSQL, Version=1.1.0.0"/>
    -->

    <!-- Registers the ADO.NET (PostgreSQL, SQLite, etc.) data warehouse store
    <section name="openiz.warehouse.ado" type="SanteDB.Warehouse.ADO.Configuration.AdoConfigurationSectionHandler, SanteDB.Warehouse.ADO, Version=1.1.0.0"/>
    -->

    <section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />

    <!-- Registers ADO.NET query persistence section
    <section name="marc.hi.ehrs.qm.persistence.data" type="MARC.HI.EHRS.QM.Persistence.Data.Configuration.ConfigurationHandler, MARC.HI.EHRS.QM.Persistence.Data, Version=2.0.0.0"/>
    -->

    <!-- Registers the REDIS cache service
    <section name="openiz.caching.redis" type="SanteDB.Caching.Redis.Configuration.RedisConfigurationHandler, SanteDB.Caching.Redis, Version=1.1.0.0"/>
    -->

    <!-- Registers IHE ATNA (DICOM/RFC-3881) auditing
    <section name="marc.hi.ehrs.svc.auditing.atna" type="MARC.HI.EHRS.SVC.Auditing.Atna.Configuration.ConfigurationSectionHandler, MARC.HI.EHRS.SVC.Auditing.Atna, Version=1.1.0.0"/>
    -->
  </configSections>
  <system.data>
    <DbProviderFactories>
      <clear/>
      <add name="PostgreSQL Data Provider" invariant="Npgsql" description=".Net Framework Data Provider for PostgreSQL" type="Npgsql.NpgsqlFactory, Npgsql, Culture=neutral, PublicKeyToken=5d8b90d52f46fda7"/>
      <!-- other provider entries elided -->
    </DbProviderFactories>
  </system.data>
  
  <!-- The following sections contain configuration for the REST endpoints being run on this server 
  NOTE: This section is a standard Microsoft.NET configuration section, for more details on setting up WCF endpoints please consult https://msdn.microsoft.com/en-us/library/ms731354(v=vs.110).aspx -->
  <system.serviceModel>
    <services>
      <!-- Enable this configuration to setup GS1 BMS (Business Messaging Standard) Messaging - Note the GS1 BMS Service must also be running
      <service name="GS1BMS" behaviorConfiguration="gs1_behavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://0.0.0.0:8080/gs1"/>
          </baseAddresses>
        </host>
        <endpoint address="http://0.0.0.0:8080/gs1" binding="webHttpBinding" contract="GS1BMS" name="GS1BMS_Behavior" bindingConfiguration="gs1_binding"/>
      </service>
      -->
      <!-- Enable this configuration to setup HL7 FHIR Endpoint Messaging - Note the HL7 FHIR Service must also be running
      <service name="MARC.HI.EHRS.SVC.Messaging.FHIR.Wcf.FhirServiceBehavior" behaviorConfiguration="fhir_Behavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://127.0.0.1:8080/fhir" />
          </baseAddresses>
        </host>
        <endpoint address="http://127.0.0.1:8080/fhir" contract="MARC.HI.EHRS.SVC.Messaging.FHIR.Wcf.IFhirServiceContract" binding="webHttpBinding" bindingConfiguration="fhir_Binding" />
      </service>
      -->
      <!-- Enable this configuration to setup OAUTH2 Access Control Service 
      <service name="SanteDB.Authentication.OAuth2" behaviorConfiguration="oauth2_behavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://0.0.0.0:8080/auth"/>
          </baseAddresses>
        </host>
        <endpoint address="http://0.0.0.0:8080/auth" binding="webHttpBinding" name="SanteDB.Authentication.OAuth2" contract="SanteDB.Authentication.OAuth2" bindingConfiguration="oauth2_binding"/>
      </service>
      -->
      <!-- Enable this coniguration to setup AMI REST endpoint
      <service name="AMI" behaviorConfiguration="ami_behavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://0.0.0.0:8080/ami"/>
          </baseAddresses>
        </host>
        <endpoint address="http://0.0.0.0:8080/ami" binding="webHttpBinding" name="AMI" contract="AMI_1.0" bindingConfiguration="ami_binding"/>
      </service>
      -->
      <!-- Enable this configuration to setup HDSI behavior
      <service name="HDSI" behaviorConfiguration="hdsi_behavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://0.0.0.0:8080/hdsi"/>
          </baseAddresses>
        </host>
        <endpoint address="http://0.0.0.0:8080/hdsi" binding="webHttpBinding" name="HDSI" contract="HDSI_1.0" bindingConfiguration="hdsi_binding"/>
      </service>
      -->
      <!-- Enable this configuration to setup RISI behavior 
      <service name="RISI" behaviorConfiguration="risi_behavior">
        <host>
          <baseAddresses>
            <add baseAddress="http://0.0.0.0:8080/risi"/>
          </baseAddresses>
        </host>
        <endpoint address="http://0.0.0.0:8080/risi" binding="webHttpBinding" name="RISI" contract="RISI_1.0" bindingConfiguration="risi_binding"/>
      </service>
      -->
    </services>
    <!-- Microsoft.NET WCF Binding Configuration -->
    <bindings>
      <webHttpBinding>
        
        <!--
        Enable this when this endpoint is running the AMI
        
        <binding name="ami_binding" maxReceivedMessageSize="2147483647">
          <security mode="None">
          </security>
        </binding>
        -->
        
        <!--
        Enable this when this endpoint is running HL7 FHIR
        
        <binding name="fhir_Binding">
          <security mode="None" >
          </security>
        </binding>
        -->
        <!--
        Enable this when this endpoint is running the ACS endpoint
        
        <binding name="oauth2_binding">
          <security mode="TransportCredentialOnly">
            <transport clientCredentialType="Basic"/>
          </security>
        </binding>
        -->
        
        <!--
        Enable this when this endpoint is running GS1 endpoint
        
        <binding name="gs1_binding">
          <security mode="None">
          </security>
        </binding>
        -->
        <!--
        Enable this when this endpoint is running HDSI endpoint
        <binding name="hdsi_binding">
          <security mode="None">
          </security>
        </binding>
        -->
        
        <!--
        Enable this when this endpoint is running RISI endpoint
        <binding name="risi_binding">
          <security mode="None">
          </security>
        </binding>
        -->
      </webHttpBinding>
    </bindings>
    <!-- Microsoft.NET WCF Service Behaviors for endpoints-->
    <behaviors>
      <serviceBehaviors>
        <!--
        Enable this when the GS1 interface is running to enable exception details
        <behavior name="gs1_behavior">
          <serviceDebug includeExceptionDetailInFaults="true"/>
          <serviceMetadata httpGetEnabled="true" httpGetUrl="http://0.0.0.0:8080/gs1"/>
        </behavior>
        -->
        <!--
        Enable this when the HL7 FHIR interface is running and using OAUTH 2 authentication with JWT tokens
        <behavior name="fhir_Behavior">
          <serviceDebug includeExceptionDetailInFaults="False" />
          <serviceMetadata httpGetEnabled="False" httpGetUrl="http://0.0.0.0:8080/fhir" />
          <serviceAuthorization principalPermissionMode="Custom" serviceAuthorizationManagerType="SanteDB.Core.Wcf.Security.JwtTokenServiceAuthorizationManager, SanteDB.Core, Version=1.1.0.0" >
            <authorizationPolicies>
              <add policyType="SanteDB.Core.Wcf.Security.JwtTokenAuthorizationPolicy, SanteDB.Core, Version=1.1.0.0"/>
            </authorizationPolicies>
          </serviceAuthorization>
        </behavior>
        -->
        <!--
        Enable this when the OAUTH2 interface is running
        <behavior name="oauth2_behavior">
          <serviceAuthorization principalPermissionMode="Custom">
            <authorizationPolicies>
              <add policyType="SanteDB.Authentication.OAuth2.Wcf.ClientAuthorizationPolicy, SanteDB.Authentication.OAuth2, Version=1.1.0.0"/>
            </authorizationPolicies>
          </serviceAuthorization>
          <serviceCredentials>
            <userNameAuthentication userNamePasswordValidationMode="Custom"
                                    customUserNamePasswordValidatorType="SanteDB.Authentication.OAuth2.Wcf.ClientCredentialValidator, SanteDB.Authentication.OAuth2, Version=1.1.0.0"/>
          </serviceCredentials>
        </behavior>
        -->
        <!--
        Enable this when the HDSI interface is running
        <behavior name="hdsi_behavior">
          <serviceDebug includeExceptionDetailInFaults="false" httpHelpPageEnabled="true" httpHelpPageUrl="http://0.0.0.0:8080/help/hdsi"/>
          <serviceAuthorization principalPermissionMode="Custom" serviceAuthorizationManagerType="SanteDB.Core.Wcf.Security.JwtTokenServiceAuthorizationManager, SanteDB.Core, Version=1.1.0.0" >
            <authorizationPolicies>
              <add policyType="SanteDB.Core.Wcf.Security.JwtTokenAuthorizationPolicy, SanteDB.Core, Version=1.1.0.0"/>
            </authorizationPolicies>
          </serviceAuthorization>
          <serviceCredentials>
          </serviceCredentials>
        </behavior>
        -->
        <!--
        Enable this when the AMI interface is running
        <behavior name="ami_behavior">
          <serviceDebug includeExceptionDetailInFaults="true"/>
          <serviceAuthorization principalPermissionMode="Custom" serviceAuthorizationManagerType="SanteDB.Core.Wcf.Security.JwtTokenServiceAuthorizationManager, SanteDB.Core, Version=1.1.0.0" >
            <authorizationPolicies>
              <add policyType="SanteDB.Core.Wcf.Security.JwtTokenAuthorizationPolicy, SanteDB.Core, Version=1.1.0.0"/>
            </authorizationPolicies>
          </serviceAuthorization>
          <serviceCredentials>
          </serviceCredentials>
        </behavior>
        -->
        <!--
        Enable this when the RISI interface is running
        <behavior name="risi_behavior">
          <serviceDebug includeExceptionDetailInFaults="true" />
          <serviceAuthorization principalPermissionMode="Custom" serviceAuthorizationManagerType="SanteDB.Core.Wcf.Security.JwtTokenServiceAuthorizationManager, SanteDB.Core, Version=1.1.0.0" >
            <authorizationPolicies>
              <add policyType="SanteDB.Core.Wcf.Security.JwtTokenAuthorizationPolicy, SanteDB.Core, Version=1.1.0.0"/>
            </authorizationPolicies>
          </serviceAuthorization>
        </behavior>
        -->
      </serviceBehaviors>
    </behaviors>
  </system.serviceModel>
  <!-- The following diagnostic sources can be configured to increase/decrease the verbosity of logging from each component -->
  <system.diagnostics>
    <sources>
      <source name="SanteDB.OrmLite" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Persistence.Data.ADO" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Persistence.Data.ADO.Services.Identity" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Core.Model.Map" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Persistence.Data.MSSQL.Services.Persistence" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Persistence.Data.MSSQL.Services.Identity" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Caching.Memory" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Core.DataSet" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Messaging.AMI" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Messaging.HDSI" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Messaging.RISI" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Persistence.Reporting" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Messaging.FHIR" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Messaging.HL7" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="MARC.HI.EHRS.SVC.Messaging.FHIR" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Authentication.OAuth2" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Core" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Core.Map" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Core.Wcf" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console"/>
        </listeners>
      </source>
      <source name="SanteDB.Persistence.Reporting.PSQL" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console" />
        </listeners>
      </source>
      <source name="SanteDB.Reporting.Core" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console" />
        </listeners>
      </source>
      <source name="SanteDB.Reporting.Jasper" switchValue="Error">
        <listeners>
          <add name="rollOver" />
          <add name="console" />
        </listeners>
      </source>
    </sources>
    <sharedListeners>
      <!-- Enables the logging to the console -->
      <add name="console" type="System.Diagnostics.ConsoleTraceListener"/>
      <!-- Outputs all log messages to an SanteDB.log file which rolls over each day -->
      <add name="rollOver" type="MARC.HI.EHRS.SVC.Core.Logging.RollOverTextWriterTraceListener, MARC.HI.EHRS.SVC.Core, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null" initializeData="openiz.log">
        <filter type="System.Diagnostics.EventTypeFilter" initializeData="Error, Information, Warning, Verbose" />
      </add>
    </sharedListeners>
    <!-- Use this section to attach the trace writers to other sources and the default tracer-->
    <trace autoflush="true">
      <listeners>
        <add name="console" />
        <add name="rollOver" />
      </listeners>
    </trace>
  </system.diagnostics>
  <!-- 
    Enable this section when you wish for the server to store query result sets in the ancillary database. Query persistence greatly increases
    query performance for large datasets, however does require a specialized database to be setup.
    
    The connectionManager should point to a connecton string name whereby the qm-ddl.sql file has been deployed
    
    <marc.hi.ehrs.qm.persistence.data>
      <connectionManager connection=""/>
    </marc.hi.ehrs.qm.persistence.data>
  -->
  <!--
  Enable this section when you wish to use ADO.NET (PostgreSQL, SQLite, etc.) persistence services. 
  <openiz.persistence.data.ado>
    <connectionManager readonlyConnection="<<name of secondary database server connection string>>"
                       readWriteConnection="<<name of primary database server connection string>>"
                       traceSql="<<true when SQL statements should be added to log, false otherwise>>"
                       autoInsertChildren="<<true when child records should be automatically inserted if they are missing, false to abort transaction>>"
                       provider="<<type of provider to use>>"/>
  </openiz.persistence.data.ado>
  
  The provider types are:
  
  PostgreSQL 9.x : SanteDB.OrmLite.Providers.PostgreSQLProvider, SanteDB.OrmLite, Version=1.1.0.0
  SQLite3 : SanteDB.OrmLite.Providers.SQLite, SanteDB.OrmLite, Version=1.1.0.0
  -->
  <!--
  Enable this section when you wish to use Microsoft SQL Server Persistence (older)
  
  <openiz.persistence.data.mssql>
    <connectionManager readonlyConnection="<<name of secondary server connection string>>" 
        readWriteConnection="<<name of primary server connection string>>" 
        traceSql="<<true if SQL should be added to logs>>" 
        keyedInserts="<<true to update objects which are being inserted and already have a duplicate key>>"
      />
  </openiz.persistence.data.mssql>

-->

  <!--
  Enable this section when you wish to use REDIS distributed caching
  
  <openiz.caching.redis>
    <server>
      <add host="<<REDIS server (default localhost)>>" port="<< REDIS port (default 6379)>>"/>
    </server>
  </openiz.caching.redis>
  -->
  <!--
  Enable this section when you wish to use in-process memory caching. This speeds up performance quite a bit for queries.
  
  
  <openiz.caching.memory autoRegister="<<true if new types not listed in cacheTarget should be automatically registered>>">
    <cacheTarget>
      <add type="<<AQN of type to be registered>>" maxAge="10:00:00:00" maxSize="<<maximum size of cache in object count>>">
        Use the following seed queries to pre-cache items matching the specified query
        <seed>
          <add>statusConcept.mnemonic=ACTIVE</add>
          <add>...</add>
        </seed>
      </add>
    </cacheTarget>
  </openiz.caching.memory>-->
  <!--
  Enable this section when this host process will run the OAUTH2.0 ACS service
  -->
  <openiz.authentication.oauth2>

    <!-- The expiry limit of a session issued from this OAUTH2.0 server. Ensure that issuerName matches the FQDN of the server this process is running on
    <token expiry="01:00:00:00" issuerName="http://localhost:8080/auth"/>
    -->

    <!-- The key to use to sign all issued OAUTH JWT tokens, must be either certificate or symmetric
    <signature>
      <certificate storeLocation="Local" storeName="" x509FindType="" findValue=""/>
      <symmetric secret="<<Server Secret Here>>"/>
    </signature>
    -->

    <!-- Claims which are allowed to be set by the client when making an OAUTH request
    <claims>
      <add claimType="http://santedb.org/claims/device-id"/>
      <add claimType="http://santedb.org/claims/scope"/>
      <add claimType="urn:oasis:names:tc:xacml:2.0:resource:resource-id"/>
      <add claimType="urn:oasis:names:tc:xacml:2.0:action:purpose"/>
      <add claimType="urn:oasis:names:tc:xspa:1.0:subject:facility"/>
      <add claimType="urn:oasis:names:tc:xspa:1.0:subject:organization-id"/>
      <add claimType="urn:oasis:names:tc:xacml:1.0:subject:subject-id"/>
    </claims>
    -->
    <!-- Scopes for which this OAUTH server is allowed to service. This should match the public FQDN of the services clients will use

    <scopes>
      <add name="http://localhost:8080/hdsi"/>
      <add name="http://localhost:8080/ami"/>
      <add name="http://localhost:8080/fhir"/>
      <add name="http://localhost:8080/gs1"/>
    </scopes>
    -->
  </openiz.authentication.oauth2>
  
  <!-- Core Configuration -->
  <openiz.core>
  
    <!-- The number of CPU threads to reserve for asynchronous PCL tasks -->
    <threading poolSize="16"/>
    
    <security>
      <!-- The applets section controls how applet files in the applet/ directory can be loaded and installed -->
      <applet allowUnsignedApplets="false">
        <!-- Publisher keys (for signed applets) which this server trusts and should load -->
        <trustedPublishers>
          <add>84BD51F0584A1F708D604CF0B8074A68D3BEB973</add>
        </trustedPublishers>
      </applet>
      
      <!-- Token validation settings if JWT token security is used -->
      <token realm="localhost">
        <!-- Audience tokens which are acceptable to the Core JWT validator-->
        <audience>
          <add name="http://localhost:8080/hdsi"/>
          <add name="http://localhost:8080/ami"/>
        </audience>
        <!-- Token issuers which are to be trusted by this server -->
        <issuer>
          <!--Example: Using a server shared secret: <add name="http://localhost:8080/auth" secret="<<Server Secret Here>>"/>-->
        </issuer>
      </token>
      <!-- Basic authentication settings if HTTP-BASIC security is to be used -->
      <basic requireClientAuth="true" realm="192.168.0.102">
        <allowedClaims>
          <add claimType="urn:oasis:names:tc:xacml:2.0:action:purpose"/>
        </allowedClaims>
      </basic>
    </security>
  </openiz.core>
  
  
  <!--
  Enable this section if this service is running HL7 FHIR endpoints.
  
  <marc.hi.ehrs.svc.messaging.fhir>
  
    <service landingPage="<<Path To HTML File for Landing>>" wcfServiceName="MARC.HI.EHRS.SVC.Messaging.FHIR.WcfCore.FhirServiceBehavior" />
    
    Represent one or more resources which should be exposed on the FHIR interface
    
    <resourceProcessors>
      <add type="SanteDB.Messaging.FHIR.Handlers.PatientResourceHandler, SanteDB.Messaging.FHIR, Version=1.1.0.0, Culture=neutral, PublicKeyToken=null" />
      <add type="SanteDB.Messaging.FHIR.Handlers.ImmunizationRecommendationResourceHandler, SanteDB.Messaging.FHIR, Version=1.1.0.0, Culture=neutral, PublicKeyToken=null" />
      <add type="SanteDB.Messaging.FHIR.Handlers.ImmunizationResourceHandler, SanteDB.Messaging.FHIR, Version=1.1.0.0, Culture=neutral, PublicKeyToken=null" />
    </resourceProcessors>
    
    Cross-origin Resource Scripting (CORS) header controls which allow JavaScript to access this server directly
    
    <cors>
      <add resource="*" domain="*">
        <action>GET</action>
        <action>OPTIONS</action>
        <action>PATCH</action>
        <action>PUT</action>
        <action>HEAD</action>
        <action>POST</action>
        <header>Accept</header>
        <header>Content-Type</header>
        <header>Content-Encoding</header>
        <header>Accept-Encoding</header>
      </add>
    </cors>
  </marc.hi.ehrs.svc.messaging.fhir>-->
  <!--
  Enable this section if this service is hosting the HDSI
  <openiz.messaging.hdsi>
    <service wcfServiceName="hdsiService"/>
  </openiz.messaging.hdsi>
  -->
  <!--
  Enable this section if this service is hosting the Administrative interface
  <openiz.messaging.ami>
    Connection strings to the Windows based CERTAdmin 
    <ca autoApprove="false" name="CANAME" serverName="DOMAIN\SERVERNAME" />
  </openiz.messaging.ami>
  -->
  <!--
  Enable this section if you wish to host an HL7 v2.x LLP receiver  
  <marc.hi.ehrs.svc.messaging.hapi>
    <services>
      <service name="LLP Listener" timeout="00:00:30" address="llp://0.0.0.0:2100">
        <handler type="SanteDB.Messaging.HL7.AdtMessageHandler, SanteDB.Messaging.HL7, Version=1.1.0.0">
          <message name="ADT^A01"/>
          <message name="ADT^A04"/>
          <message name="ADT^A05"/>
          <message name="ADT^A08"/>
        </handler>
        <handler type="SanteDB.Messaging.HL7.NotSupportedMessageHandler, SanteDB.Messaging.HL7, Version=1.1.0.0">
          <message name="*"/>
        </handler>
      </service>
    </services>
  </marc.hi.ehrs.svc.messaging.hapi>-->
  
  <!-- Core Configuration for the Service Core. Please configure this carefully to prevent collisions with other deployments -->
  <marc.hi.ehrs.svc.core>
    <system>
      <device id="1.3.6.1.4.1.YOUR.PEN.HERE.3.1.5.9" name="My OpenIZ Server"/>
    </system>
    <!-- Custodial information for records -->
    <custodianship>
      <name>My Custodianship Information</name>
      <!-- Identifies the domain under which identifiers are reported from this registry -->
      <id domain="1.3.6.1.4.1.YOUR.PEN.HERE.3.1.5.9.0" value="OpenIZ1"/>
    </custodianship>
    <!-- Realm that the persistence engine is running within -->
    <jurisdiction>
      <name>Fake Jurisdiction</name>
      <id domain="1.3.6.1.4.1.YOUR.PEN.HERE.3.1.5.9.0" value="HI"/>
      <!-- The next three lines identify the realm (roots) that should be
      returned in messages when communicating with external entities-->
      <clientExport domain="1.3.6.1.4.1.YOUR.PEN.HERE.3.1.2.1.0"/>
      <providerExport domain="1.3.6.1.4.1.YOUR.PEN.HERE.3.1.2.1.1"/>
      <sdlExport domain="1.3.6.1.4.1.YOUR.PEN.HERE.3.1.2.1.2"/>
      <defaultLanguageCode code="en"/>
    </jurisdiction>
    <!-- 
    Service Providers are like mini-application services that run inside the OpenIZ host process. If you enable / disable services
    then your instance of OpenIZ will behave differently and will have more/less functionality 
    -->
    <serviceProviders>

      <!--
      Enable one of these services for the type of password hashing you would like in OpenIZ
      
      SHA256: <add type="SanteDB.Core.Security.SHA256PasswordHashingService, SanteDB.Core, Version=1.1.0.0"/>
      SHA1: <add type="SanteDB.Core.Security.SHA1PasswordHashingService, SanteDB.Core, Version=1.1.0.0"/>
      MD5: <add type="SanteDB.Core.Security.MD5PasswordHashingService, SanteDB.Core, Version=1.1.0.0"/>
      Plain: <add type="SanteDB.Core.Security.PlainTextPasswordHashingService, SanteDB.Core, Version=1.1.0.0"/>
      -->

      <!--
      Enable these services if you are running Microsoft SQL Server Persistence Services
      <add type="SanteDB.Persistence.Data.MSSQL.Services.SqlServerPersistenceService, SanteDB.Persistence.Data.MSSQL, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.MSSQL.Services.SqlPolicyInformationService, SanteDB.Persistence.Data.MSSQL, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.MSSQL.Services.SqlRoleProvider, SanteDB.Persistence.Data.MSSQL, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.MSSQL.Services.SqlIdentityProvider, SanteDB.Persistence.Data.MSSQL, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.MSSQL.Services.SqlApplicationIdentityProvider, SanteDB.Persistence.Data.MSSQL, Version=1.1.0.0"/>-->
      
      <!--
      Enable these services for ADO.NET persistence 
      <add type="SanteDB.Persistence.Data.ADO.Services.AdoApplicationIdentityProvider, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.ADO.Services.AdoDeviceIdentityProvider, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.ADO.Services.AdoPersistenceService, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.ADO.Services.AdoPolicyInformationService, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.ADO.Services.AdoRoleProvider, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.ADO.Services.AdoIdentityProvider, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      <add type="SanteDB.Persistence.Data.ADO.AdoOidRegistrarService, SanteDB.Persistence.Data.ADO, Version=1.1.0.0"/>
      -->
    
      <!-- 
      Enable this service to allow contact on the IMS interface
      <add type="SanteDB.Messaging.HDSI.HdsiMessageHandler, SanteDB.Messaging.HDSI, Version=1.1.0.0"/>
      -->
      
      <!-- 
      Enable this service to allow contact on the RISI (report) interface
      <add type="SanteDB.Messaging.RISI.RisiMessageHandler, SanteDB.Messaging.RISI, Version=1.1.0.0"/>
      -->
      
      <!-- 
      Enable this interface to allow contact on the Administrative interface
      <add type="SanteDB.Messaging.AMI.AmiMessageHandler, SanteDB.Messaging.AMI, Version=1.1.0.0"/>
      -->

      <!-- 
      Enable this interface to set this service as an ACS
      <add type="SanteDB.Authentication.OAuth2.OAuthMessageHandler, SanteDB.Authentication.OAuth2, Version=1.1.0.0"/>
      -->

      <!--
      Enable this interface to allow contact on a GS1 BMS message
      <add type="SanteDB.Messaging.GS1.StockServiceMessageHandler, SanteDB.Messaging.GS1, Version=1.1.0.0"/>
      -->

      <!-- 
      Enable this service if this host is to act as a data intializer which is responsible for setting up the primary database.
      Only one machine in an OpenIZ cluster should be a data initializer
      <add type="SanteDB.Core.Persistence.DataInitializationService, SanteDB.Core, Version=1.1.0.0"/>
      -->

      <!-- 
      Enable this service to allow communications using HL7v2.x messaging
      <add type="MARC.HI.EHRS.SVC.Messaging.HAPI.HL7MessageHandler, MARC.HI.EHRS.SVC.Messaging.HAPI, Version=2.0.0.0"/>
      -->

      <!-- 
      Enable this service to allow communications using HL7 FHIR messaging
      <add type="MARC.HI.EHRS.SVC.Messaging.FHIR.FhirMessageHandler, MARC.HI.EHRS.SVC.Messaging.FHIR, Version=2.0.0.0"/>
      -->

      <!-- Core Services: Disabling these are unwise -->
      <add type="SanteDB.Core.Services.Impl.LocalConceptRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalPatientRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalSecurityRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalMaterialRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalPlaceRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalProviderRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalPersonRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalMetadataRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalActRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalAlertRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalOrganizationRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalIdentifierTypeRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalAssigningAuthorityRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalStockManagementRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalEntityRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.SimplePatchService, SanteDB.Core.Api, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalBatchRepositoryService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.ThreadPoolService, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Services.Impl.LocalServiceManager, SanteDB.Core, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Security.Audit.AuditDaemonService, SanteDB.Core, Version=1.1.0.0"/>

      <!-- Change this if you wish to use an external policy decision service (PDP) -->
      <add type="SanteDB.Core.Security.LocalPolicyDecisionService, SanteDB.Core, Version=1.1.0.0"/>

      <!-- Change this if you wish to use a custom phonetic algorithm calculation service -->
      <add type="SanteDB.Core.Services.Impl.NullPhoneticAlgorithmHandler, SanteDB.Core.Api, Version=1.1.0.0"/>

      <!--
      Enable this service if you wish for sherlock diagnostic reports to go to a JIRA server
      <add type="SanteDB.Persistence.Diagnostics.Jira.DiagnosticReportPersistenceService, SanteDB.Persistence.Diagnostics.Jira, Version=1.1.0.0"/>
      -->

      <!--
      Enable this service if you wish to use the in-process memory caching
      <add type="SanteDB.Caching.Memory.MemoryCacheService, SanteDB.Caching.Memory, Version=1.1.0.0"/>
      -->
      <!--
      Enable this service if you wish to enable REDIS shared memory caching
      <add type="SanteDB.Caching.Redis.RedisCacheService, SanteDB.Caching.Redis, Version=1.1.0.0"/>
      -->
      
      <!--
      Enable this service if you wish to enable timer jobs (recommended)
      <add type="MARC.HI.EHRS.SVC.Core.Timer.TimerService, MARC.HI.EHRS.SVC.Core.Timer, Version=1.1.0.0"/>
      -->
      
      <!--
      Enable this service to broadcast new patient registrations to a IHE PIX based client registry
      <add type="SanteDB.Messaging.HL7.Services.ClientRegistryNotificationService, SanteDB.Messaging.HL7, Version=1.1.0.0"/>
      -->
      
      <!--
      If you wish to enable Two-factor authentication on this server you will need to enable a relay service. This is a default implementation
      <add type="SanteDB.Core.Security.DefaultTfaRelayService, SanteDB.Core, Version=1.1.0.0"/>
      -->
      <!--
      For password reset, the service will require a TFA Secret generator, this defualt implementation generates a 4 digit numeric code
      <add type="SanteDB.Core.Security.SimpleTfaSecretGenerator, SanteDB.Core, Version=1.1.0.0"/>
      -->

      <!--
      Enabling these services will provide two-factor mechanisms for email and SMS
      <add type="SanteDB.Core.Security.Tfa.Email.TfaEmailMechanism, SanteDB.Core.Security.Tfa.Email, Version=1.1.0.0"/>
      <add type="SanteDB.Core.Security.Tfa.Twilio.TfaTwilioMechanism, SanteDB.Core.Security.Tfa.Twilio, Version=1.1.0.0"/>-->
      -->

      <!--
      Enabling this service will allow caching of report parameters using PostgreSQL
      <add type="SanteDB.Persistence.Reporting.PSQL.ReportingPersistenceService, SanteDB.Persistence.Reporting.PSQL, Version=1.1.0.0"/>
      -->
      
      <!-- This service loads all business rules from installed applets on the server. You can override this behavior by implementing a different daemon service -->
      <add type="SanteDB.Core.Services.Daemons.AppletBusinessRulesDaemon, SanteDB.Core, Version=1.1.0.0" />
      
      <!-- This service allows maintenance of applets on the server using a directory -->
      <add type="SanteDB.Core.Services.Impl.LocalAppletManagerService, SanteDB.Core, Version=1.1.0.0"/>
      
      <!-- 
      Enable this service to allow for persistence of queries to/from an ADO.NET based data source
      <add type="MARC.HI.EHRS.QM.Persistence.Data.AdoQueryPersistenceService, MARC.HI.EHRS.QM.Persistence.Data, Version=2.0.0.0"/>
      -->
      
      <!-- This service allows for clinical protocols to be loaded from installed applets on the server -->
      <add type="SanteDB.Protocol.Xml.AppletClinicalProtocolRepository, SanteDB.Protocol.Xml, Version=1.1.0.0"/>
      
      <!-- This service provides simple generation of a care plan using the protocol repository. More complex care plans can be calculated
      by overriding this implementation with a custom implementation -->
      <add type="SanteDB.Core.Protocol.SimpleCarePlanService, SanteDB.Core.Api, Version=1.1.0.0"/>
      
      <!-- 
      Enable this service to store data warehousing information to an ADO.NET source
      <add type="SanteDB.Warehouse.ADO.ADODataWarehouse, SanteDB.Warehouse.ADO, Version=1.1.0.0"/>
      -->
      
      <!--
      Enable this service to use Jasper Reports Server for the purpose of rendering reports
      <add type="SanteDB.Reporting.Jasper.JasperReportExecutor, SanteDB.Reporting.Jasper, Version=1.1.0.0" />
      -->
      
      <!-- 
      Enable this service to allow the OpenIZ host to send audits to an RFC-3881 or DICOM audit repository
      <add type="MARC.HI.EHRS.SVC.Auditing.Atna.AtnaAuditService, MARC.HI.EHRS.SVC.Auditing.Atna, Version=2.0.0.0"/>
      -->
      
    </serviceProviders>
  </marc.hi.ehrs.svc.core>
  <!-- 
  Enable this section when JIRA is being used as the storage provider for diagnostic events and bug reports
  <openiz.persistence.diagnostics.jira>
    <jira url="<<url to JIRA>>" project="<<JIRA project where bugs should be filed>>"/>
    <auth username="" password=""/>
  </openiz.persistence.diagnostics.jira>
  -->
  
  <!--
  Enable this section when two-factor authentication via e-mail is being used
  <openiz.core.security.tfa.email>
    <smtp server="" ssl="" username="" password="" />
  </openiz.core.security.tfa.email>
  -->
  <!--
  Enable this section when two-factor authentication via Twilio SMS is being used
  <openiz.core.security.tfa.twilio>
    <sms sid="" auth="" from="" />
  </openiz.core.security.tfa.twilio>
  -->
  <!--
  Enable this section when PIX/PDQ notifications are being sent 
  <openiz.messaging.hl7.notification.pixpdq concurrencyLevel="2">
    <targets>
      <add connectionString="<<address of the PIX endpoint>>" deviceId="<<SENDING_DEVICE>>|<<SENDING_FACILITY>>" name="<<Name of IHE Recipient>>" myActor="PAT_IDENTITY_SRC">
        <notify domain="<<OID which new patients should carry to trigger a notification>>">
          <action type="Any"/>
        </notify>
      </add>
    </targets>
  </openiz.messaging.hl7.notification.pixpdq>-->
  <!--
  Enable this section when report parameters and report meta-data are to be stored using postgresql
  <openiz.persistence.reporting.psql>
    <connectionManager readonlyConnection="<<connection string name to secondary>>"
                       readWriteConnection="<<connection string name to primary>>"
                       traceSql="true"
                       autoUpdateExisting="true"
                       provider="SanteDB.OrmLite.Providers.PostgreSQLProvider, SanteDB.OrmLite, Version=1.1.0.0"/>
  </openiz.persistence.reporting.psql>
  -->
  <openiz.reporting.core>
    <reportEngine type="SanteDB.Reporting.Jasper.JasperReportExecutor, SanteDB.Reporting.Jasper, Version=1.1.0.0" address="http://jasperintl.marc-hi.ca:8080/jasperserver"/>
    <credentials type="UsernamePassword">
      <credential username="jasperadmin" password="jasperadmin" />
    </credentials>
  </openiz.reporting.core>
  <!--
  Enable this section for core timer jobs to be enabled
  <marc.hi.svc.core.timer>
    This job is sed to clean all stale queries from the query persistence table and should only be enabled if query persistence is also enabled
    <job timer="00:01:00:00.0000" type="MARC.HI.EHRS.QM.Persistence.Data.QueryPersistenceCleanJob, MARC.HI.EHRS.QM.Persistence.Data, Version=2.0.0.0"/>
  </marc.hi.svc.core.timer>
  -->
  <!--
  Enable this section when ADO.NET persistence is being used for the ad-hoc data warehouse functions
  <openiz.warehouse.ado>
    <connectionManager readonlyConnection="<<connection string name to secondary>>"
                          readWriteConnection="<<connection string name to primary>>"
                          traceSql="false"
                          provider="<<ADO provider AQN to use when connecting to the warehouse (see primary ado configuration)>>"/>
  </openiz.warehouse.ado>
  -->
  <!--
  Enable this section when audits are to be sent in RFC-3881 or DICOM format to an audit repository
  <marc.hi.ehrs.svc.auditing.atna messagePublisher="AtnaApi.Transport.UdpSyslogTransport, AtnaApi, Version=1.1.0.0" format="RFC-3881 or DICOM">
    <destination endpoint="<<ip address:port of audit repository>>" />
  </marc.hi.ehrs.svc.auditing.atna>-->
  <connectionStrings>
    <!-- This is the standard .NET connection string section. You should collect all your connection strings used in previous configuration seti-->
  </connectionStrings>
  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5"/>
  </startup>
  <entityFramework>
    <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" />
    <providers>
      <provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" />
    </providers>
  </entityFramework>

</configuration>